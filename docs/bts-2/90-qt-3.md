# Exercices

Au travers des exercices suivants, vous allez pouvoir manipuler les widgets et le m√©canisme de signal/slot sur la base du cours, des √©l√©ments vus pr√©c√©demment et de vos recherches dans la documentation.

![qt-16](../images/cours/bts-2/90/qt-16.png)

Cr√©er une application graphique QT Widgets dont le titre est **TP QT BTS2** et qui servira de projet pour l‚Äô**ensemble des exercices**.
    
## Exercice 1

!!! abstract "Objectifs"

    +   Cr√©er des boutons
    
    +   Leur affecter des actions avec le designer et avec le code.

1. Ajouter 4 boutons √† l‚Äôaide du designer :
    
    ![qt-17](../images/cours/bts-2/90/qt-17.png)
    
2. Utiliser l'association des signaux et slots ( ++f4++ ) pour r√©aliser ces 3 actions :

    - Bouton **Agrandir** affiche la fen√™tre en taille maximale.

    - Bouton **Normal** affiche la fen√™tre dans sa taille d'origine

    - Bouton **Quitter** ferme l'application

3. Utiliser la **connexion par le code** pour r√©aliser l'action suivante :

    - Bouton **R√©duire** r√©duit la fen√™tre dans la barre des t√¢ches (MainWindow).

## Exercice 2

!!! abstract "Objectifs"

    +   Modifier¬†un widget cr√©√© via le designer par le code

    +   Faire communiquer deux widgets en utilisant le designer.

1. Ajouter un widget ComboBox et un widget LineEdit via le designer¬†:
    
    ![qt-18](../images/cours/bts-2/90/qt-18.png)
    
2. Remplir la ComboBox avec la m√©thode `addItem()` de la classe `QComboBox` depuis le constructeur de la `MainWindow` (en utilisant `ui`).

3. Utiliser l'association des signaux et slots (F4) pour remplacer le texte du LineEdit par le texte de l‚Äôitem s√©lectionn√© dans la ComboBox.

## Cr√©ation de signals et de slots

<object class="fullScreenAble" data="../../pdf/cours/bts2/bts2_qt_05.pdf" type="application/pdf"></object>

## Exercice 3

!!! abstract "Objectifs"

    Cr√©er un slot et le connecter √† des widgets.

1. Ajouter un GroupBox et y ajouter deux RadioButton.
    
    ![qt-19](../images/cours/bts-2/90/qt-19.png)
    
    Suivant la s√©lection, une image sera affich√©e ou non au fond de la fen√™tre.
    
2. Ajouter un slot `changeBackground()` dans la classe `MainWindow` pour traiter la s√©lection des `QRadioButton`. La d√©finition de la m√©thode sera trait√©e plus loin dans l‚Äôexercice.

3. Par programmation, dans le constructeur de la `MainWindow`, connecter (avec la primitive `connect`) le signal `clicked()` des deux `QRadioButton` au slot `changeBackground()`.

4. Ajouter une image en tant que ressource du projet¬†:

    1. Dans l‚Äôarborescence, cliquer-droit sur le nom du projet et choisir **Add new‚Ä¶**

    2. Dans la fen√™tre, choisir **Qt > Qt Resource File** et cliquer sur **Choose‚Ä¶**
        
        ![qt-20](../images/cours/bts-2/90/qt-20.png)
        
    3. Nommer le fichier **resources.qrc** et valider les √©tapes suivantes

    4. Double-cliquer sur le nouveau fichier

    5. Cliquer sur **Add Prefix**

    6. Modifier la valeur du **Pr√©fixe**¬†pour **/images**

    7. Copier-coller une image (800x600) au choix dans le dossier du projet via l‚Äôexplorateur Windows

    8. Cliquer sur **Add Files**

    9. S√©lectionner l‚Äôimage et valider
        
        ![qt-21](../images/cours/bts-2/90/qt-21.png)
        
    10. Sauvegarder le fichier **resources.qrc**

5. En fonction du `QRadioButton` coch√© (`checked`), utiliser la m√©thode `setStyleSheet()` de la classe `MainWindow` pour changer l‚Äôimage de fond du widget central¬†avec une des valeurs suivantes :
    
    ```cpp
    // Utiliser une image pour le fond d'√©cran
    "#centralwidget { background-image: url(:/images/{nom_de_l_image.jpg); }"
    
    // Masquer l'image en fond d'√©cran
    "#centralwidget { background-image: none; }"
    ```
    
## Exercice 4

!!! abstract "Objectifs"

    R√©cup√©rer une valeur de l‚ÄôIHM depuis un slot cr√©√©.

On veut pouvoir modifier le titre de la fen√™tre apr√®s avoir saisi une valeur dans un widget LineEdit et appuy√© sur Entr√©e.

Peut-on le faire directement depuis le designer¬†? Pourquoi¬†?

1. Ajouter un widget **LineEdit**.
    
    ![qt-22](../images/cours/bts-2/90/qt-22.png)
    
2. Cr√©er un slot `changeWindowTitle()` dans la classe `MainWindow`.

3. R√©cup√©rer la valeur du widget `QLineEdit` et la passer √† la m√©thode `setWindowTitle()` de la classe `MainWindow`.

4. Avec le designer, r√©aliser la connexion n√©cessaire pour r√©pondre au besoin. 

Si le slot cr√©√© n‚Äôappara√Æt pas dans la liste, il faut l‚Äôajouter en utilisant le bouton **Editer‚Ä¶** de la fen√™tre **Configurer connexion**.
    
![qt-23](../images/cours/bts-2/90/qt-23.png)

## Repartir du bon pied

Projet avec les 4 premiers exercices : üìÇ[TP_QT_BTS2 0.4](../files/bts2/TP_QT_BTS2.zip)

## Exercice 5

!!! abstract "Objectifs"

    +   Passer des valeurs d‚Äôun widget √† un autre
    +   Cr√©er et √©mettre un signal

On souhaite r√©aliser une calculatrice "simple"¬†:

![qt-36](../images/cours/bts-2/90/qt-36.png)

+ Elle est compos√©e de deux **sliders** qui pilotent l‚Äôaffichage de deux **LCDNumber**.

+ Le **+** central est affich√© √† l‚Äôaide d‚Äôun label.

+ L‚Äôaffichage sombre des **LCDNumber** est r√©alis√© en passant la propri√©t√© **segmentStyle** √† **Flat**.

**R√©aliser cette premi√®re partie** de l‚Äôexercice avec le designer.

![qt-37](../images/cours/bts-2/90/qt-37.png)

Au clic sur le bouton **=**, la somme des deux valeurs de **sliders** doit s‚Äôafficher dans un troisi√®me **LCDNumber**. Toutefois, le signal clicked() de la classe QPushButton n‚Äôa pas de param√®tre de type entier et¬† permet encore moins d‚Äôenvoyer deux valeurs qui ne lui appartiennent pas.

![qt-38](../images/cours/bts-2/90/qt-38.png)

Le clic sur le `QPushButton` va devoir d√©clencher un slot (√† cr√©er) dans la classe `MainWindow` qui va lui-m√™me √©mettre un signal au bon format (√† cr√©er) qui sera connecter au slot `display(int)` du troisi√®me `QLCDNumber`.

**R√©aliser cette seconde partie** pour terminer la ¬´¬†calculatrice¬†¬ª.

## Exercice 6

!!! abstract "Objectifs"

    +   Utiliser les slots de manipulation de texte.
    +   Personnaliser un widget avec une image

1. Ajouter sur la fen√™tre un widget Textedit et deux boutons Copier et Coller pour copier ou coller du texte dans notre boite de texte.
    
    Les icones sont modifiables dans la fen√™tre des propri√©t√©s via l‚Äôattribut ¬´¬†Marche normale¬†¬ª de l‚Äôattribut icon des `QAbstractButton`. On peut trouver de nombreuses icones libres de droits sur Internet, par exemple sur le site [iconmonstr.com](https://iconmonstr.com/).
    
2. Ajouter une ic√¥ne aux deux boutons en important au pr√©alable deux icones dans le fichier resources.qrc.
    
    ![qt-39](../images/cours/bts-2/90/qt-39.png)
    
3. Utiliser l'association des signaux et slots ( ++f4++ ) pour finir l‚Äôexercice.

## Exercice 7

!!! abstract "Objectifs"

    Comprendre le fonctionnement des progressBar.

1. Ajouter un widget Progress bar et un bouton Lancer.
    
    ![qt-40](../images/cours/bts-2/90/qt-40.png)
    
    Il va falloir dans le slot du bouton faire une boucle allant de 0 √† 100 et qui sera temporis√©e √† chaque tour pendant 100ms. Pour temporiser le programme, on utilisera la m√©thode `msleep(int)` de la classe `QThread` qui suspend le thread.
    
2. Lancer la progression de la barre en prenant comme unit√© le centi√®me de seconde.

??? danger "Aller plus loin"

    Temporiser avec `QThread::msleep()` met en sommeil le thread de l'application et bloque l'utilisation de l'IHM üò•

    Etudier l'utilisation de la classe `QTimer` et l'impl√©menter pour ne pas paralyser l'application.

## Repartir du bon pied

Projet avec les 7 premiers exercices : üìÇ[TP_QT_BTS2 0.7](../files/bts2/TP_QT_BTS2_2.zip)

## Exercice 8

!!! abstract "Objectifs"

    Ajouter une action dans le menu.

1. Ajouter un menu sur la fen√™tre. Ce menu pour l'instant n'a que l'option **Quitter** qui fermera notre application.
    
    ![qt-41](../images/cours/bts-2/90/qt-41.png)
    
2. Connecter le signal `triggered()` sur l'action **Quitter** du menu au slot `close()` de l'application.

## Exercice 9

!!! abstract "Objectifs"

    +   Surd√©finir une fonction d‚Äôune classe ascendante

    +   Impl√©menter une classe du framework en s‚Äôaidant de la documentation

L‚Äôapplication peut √† pr√©sent √™tre ferm√©e depuis le menu, depuis la croix en haut √† droite et depuis le bouton cr√©er dans l‚Äôexercice 1. On souhaite pr√©venir toute fermeture accidentelle par l‚Äôajout d‚Äôune confirmation avant fermeture. L‚Äôimpl√©menter dans chacun des trois m√©canismes mis en place ne serait pas tr√®s pertinent.

Qt a pr√©vu ce genre de besoin en cr√©ant une m√©thode `closeEvent()` dans la classe `QWidget`. Cette derni√®re centralise les appels √† la fermeture de fen√™tre. Pour ajouter le comportement attendu, il faut surd√©finir cette fonction dans notre `MainWindow`.

1. Surd√©finir la m√©thode `QWidget::closeEvent()` dans la `MainWindow`.
    
    Le param√®tre `event` de la m√©thode permet d‚Äôagir sur la fermeture en l‚Äôacceptant ou l‚Äôignorant √† l‚Äôaide des m√©thodes `accept()` et `ignore()`. De base, l‚Äôimpl√©mentation de `QWidget::closeEvent()` accepte toujours l‚Äô√©v√©nement.
    
    Pour savoir si on accepte ou non la fermeture de la fen√™tre, on va utiliser une `QMessageBox` dont la documentation officielle donne des exemples d‚Äôimpl√©mentation tr√®s complet.
    
    ![qt-42](../images/cours/bts-2/90/qt-42.png)
    
2. R√©aliser la fonctionnalit√© √† l‚Äôaide des √©l√©ments ci-dessous et de la documentation de Qt.

## Exercice 10

!!! abstract "Objectifs"

    +   Ajouter une fen√™tre √† l‚Äôapplication

    +   Manipuler des √©l√©ments graphiques

Dans ce dernier exercice, on souhaite ajouter un nouveau menu qui permettra d‚Äôouvrir une fen√™tre dans laquelle on pourra manipuler une forme graphique (rectangle ou cercle).

![qt-43](../images/cours/bts-2/90/qt-43.png)

1.  Ajouter au projet une nouvelle classe d‚Äôinterface graphique Qt Designer (Dialog)
    
    ![qt-44](../images/cours/bts-2/90/qt-44.png)

2.  En fonction de la version de Qt, le g√©n√©rateur peut proposer de choisir un type de fen√™tre¬†: choisir une fen√™tre sans bouton et valider les √©tapes suivantes.

3.  Ajouter un bouton ¬´¬†Annuler¬†¬ª sur la nouvelle fen√™tre et faire en sorte qu‚Äôil ferme la fen√™tre quand on clique dessus.
    
    Deux slots permettent de fermer une fen√™tre de type `QDialog`¬†: `accept()` et `reject()`.
    
4.  Ajouter une action **Figures** dans le menu **Menu** de la `MainWindow`.

5.  Cr√©er un slot `showDialog()` dans la `MainWindow` et le d√©clencher quand on clique sur le menu **Figures**.

6.  Pour ouvrir la nouvelle fen√™tre, il faut cr√©er un objet de la classe de Dialog et lancer sa m√©thode exec(). 

    Ouvrir la nouvelle fen√™tre au clic sur le menu **Figures**.

7.  On souhaite afficher un rectangle dans un widget `QGraphicsView` et piloter sa largeur et sa hauteur via deux **sliders** dispos√©s respectivement en dessous et sur la droite de ce widget.
    
    Ajouter les trois widgets avec le designer.
    
8.  Pour afficher le rectangle, il faut ajouter un objet `QGraphicsScene` dans le widget **GraphicsView** et y dessiner un rectangle avec la m√©thode `addRect()`.
    
    Exemple de code¬†:
    
    ```cpp
    // Cr√©ation de la sc√®ne
    
    QGraphicsScene * scene = new QGraphicsScene(ui->graphicsView);
    
    scene.setSceneRect(0, 0, 256, 192);
    
    ui->graphicsView->setScene(scene);
    
    // Cr√©ation du rectangle
    
    QGraphicsRectItem * rectangle = scene->addRect(10, 10, 80, 50);
    ```
    
    Afficher un rectangle dans le widget **GraphicsView**.
    
9.  Pour modifier les dimensions du rectangle, il faut red√©finir ses dimensions √† l‚Äôaide de la m√©thode `setRect()`.

    Piloter les dimensions du **rectangle** avec les **sliders**.

10. Ajouter un widget **ComboBox** qui permet de permuter l‚Äôaffichage entre un **rectangle** et une **ellipse**.