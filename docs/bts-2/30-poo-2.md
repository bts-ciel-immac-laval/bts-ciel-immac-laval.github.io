# 03 - POO level 2

## Exercice 1

Sur la base du diagramme de classes ci-dessous, créer le programme qui permet de saisir les noms de plusieurs personnes puis un nombre de groupes à créer. 

![group_person.png](../images/cours/bts-2/30/group_person.png)

Le programme se chargera ensuite de répartir automatiquement les personnes dans les groupes. 

Finalement il affichera la composition des groupes et le groupe d'appartenance de chaque personne.
    
??? tip "Indice"
    
    La classe `std::vector` peut être utile.
    
??? tip "Indice"
    
    On créera d'abord les personnes, puis les groupes dans le `main`.

    Ensuite on attache les personnes aux groupes et les groupes aux personnes.

    On manipulera des **pointeurs** pour les références afin d'éviter les recopies d'objets.

```
> ./exo_1.exe
Saisir les noms des personnes à créer (! pour arrêter) :
#1 : Bianca
#2 : Tryphon
#3 : Archibald
#4 : Allan
#5 : Piotr
#6 : Tchang
#7 : Seraphin
#8 : !
7 personnes saisies.

Nombre de groupes à créer : 3

1
Bianca (1)
Allan (4)
Seraphin (7)

2
Tryphon (2)
Piotr (5)

3
Archibald (3)
Tchang (6)

Bianca (1) appartient au groupe 1
Tryphon (2) appartient au groupe 2
Archibald (3) appartient au groupe 3
Allan (4) appartient au groupe 1
Piotr (5) appartient au groupe 2
Tchang (6) appartient au groupe 3
Seraphin (7) appartient au groupe 1
```

??? success "Correction"

    :octicons-file-24: exo1/person.hpp

    ```cpp
    #include <string>

    #ifndef PERSON_H
    #define PERSON_H

    using namespace std;

    class Group;   // On triche pour éviter une mise en abyme infinie des includes croisés.

    class Person {
        private :
            int id;
            static int count;
            string name;
            Group * group;  // Pour éviter les recopies d'objets, on utilise un pointeur.

        public:
            Person(string);
            void display();
            Group getGroup();
            void setGroup(Group &); // Le passage par référence simplifie l'utilisation de la méthode.
    };

    #endif
    ```

    :octicons-file-24: exo1/person.cpp

    ```cpp
    #include "person.hpp"
    #include "group.hpp"
    #include <iostream>
    #include <string>

    using namespace std;

    int Person::count = 0;

    Person::Person(string _name) {
        name = _name;
        count++;
        id = count;
    }

    void Person::display() {
        cout << name << " (" << id << ")";
    }

    void Person::setGroup(Group & _group) {
        group = & _group;
    }

    Group Person::getGroup() {
        return * group;
    }
    ```

    :octicons-file-24: exo1/group.hpp

    ```cpp
    #include <vector>

    #ifndef GROUP_H
    #define GROUP_H

    using namespace std;

    class Person;   // On triche pour éviter une mise en abyme infinie des includes croisés.

    class Group {
        private :
            int id;
            vector<Person *> people;  // Pour éviter les recopies d'objets, on utilise des pointeurs.
            static int count;

        public :
            Group();
            int getId();
            void addPerson(Person &); // Le passage par référence simplifie l'utilisation de la méthode.
            void display();
            static int getCount();
    };

    #endif
    ```

    :octicons-file-24: exo1/group.cpp

    ```cpp
    #include "group.hpp"
    #include "person.hpp"
    #include <iostream>

    using namespace std;

    int Group::count = 0;

    Group::Group() {
        count++;
        id = count;
    }

    int Group::getId() {
        return id;
    }

    void Group::addPerson(Person & p) {
        people.push_back(&p);
    }

    void Group::display() {
        cout << id << endl;
        for (int i = 0; i < people.size(); i++) {
            people[i]->display();   // -> car ce sont des pointeurs qu'on manipule
            cout << endl;
        }
    }
    ```

    :octicons-file-24: exo1/main.cpp

    ```cpp
    #include <iostream>
    #include <vector>
    #include <string>
    #include "person.hpp"
    #include "group.hpp"

    using namespace std;

    int main() {

        vector<Person> allPeople;   // Un tableau pour stocker les personnes créées au fur et à mesure.
        vector<Group> allGroups;    // Un tableau pour stocker les groupes créés.
        
        string input = "";          // Un tampon pour récupérer les noms saisis.
        int nbGroups = 0;
        
        system("chcp 65001");       // Passage de la console Windows en UTF-8
        system("cls");              // Nettoyage de la console

        // Saisie
        cout << "Saisir les noms des personnes à créer (vide pour arrêter) :" << endl;
        do {
            cout << "#" << allPeople.size() + 1 << " : ";
            
            getline(cin, input);    // Permet d'autoriser les saisies vides.

            // Création d'une nouvelle personne
            if (input != "") {
                allPeople.push_back(Person(input));
            }

        } while (input != "");

        cout << endl << allPeople.size() << " personne(s) saisie(s)" << endl << endl;

        // Création des groupes
        do {
            cout << "Nombre de groupes à créer : ";
            cin >> nbGroups;
        } while (nbGroups <= 0);
        for (int i = 0; i < nbGroups; i++) {
            allGroups.push_back(Group());
        }

        // Répartition des personnes dans les groupes
        for (int i = 0; i < allPeople.size(); i++) {
            allGroups[i % nbGroups].addPerson(allPeople[i]);
            allPeople[i].setGroup(allGroups[i % nbGroups]);
        }

        // Affichage des groupes
        cout << endl;
        for (int i = 0; i < allGroups.size(); i++) {
            allGroups[i].display();
            cout << endl;
        }
        cout << endl;

        // Affichage des personnes
        for (int i = 0; i < allPeople.size(); i++) {
            allPeople[i].display();
            cout << " appartient au groupe " << allPeople[i].getGroup().getId() << endl;
        }

        return 0;
    }
    ```
